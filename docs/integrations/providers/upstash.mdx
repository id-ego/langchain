---
description: 업스태시는 개발자에게 서버리스 데이터베이스와 메시징 플랫폼을 제공하여 복잡한 운영 없이 강력한 애플리케이션을 구축할 수 있게
  합니다.
---

Upstash는 개발자에게 서버리스 데이터베이스와 메시징 플랫폼을 제공하여 데이터베이스를 대규모로 운영하는 복잡성에 대해 걱정하지 않고도 강력한 애플리케이션을 구축할 수 있도록 합니다.

Upstash의 주요 장점 중 하나는 그들의 데이터베이스가 HTTP를 지원하고 모든 SDK가 HTTP를 사용한다는 점입니다. 이는 서버리스 플랫폼, 엣지 또는 TCP 연결을 지원하지 않는 모든 플랫폼에서 실행할 수 있음을 의미합니다.

현재 LangChain을 위한 두 가지 Upstash 통합이 제공됩니다:
Upstash Vector는 벡터 임베딩 데이터베이스로, Upstash Redis는 캐시 및 메모리 저장소로 사용됩니다.

# Upstash Vector

Upstash Vector는 벡터를 저장하고 쿼리하는 데 사용할 수 있는 서버리스 벡터 데이터베이스입니다.

## 설치

[Upstash Console](https://console.upstash.com/vector)에서 새로운 서버리스 벡터 데이터베이스를 생성합니다. 모델에 따라 선호하는 거리 측정 기준과 차원 수를 선택합니다.

`pip install upstash-vector`로 Upstash Vector Python SDK를 설치합니다. LangChain의 Upstash Vector 통합은 Upstash Vector Python SDK의 래퍼입니다. 따라서 `upstash-vector` 패키지가 필요합니다.

## 통합

Upstash Console의 자격 증명을 사용하여 `UpstashVectorStore` 객체를 생성합니다. 텍스트를 벡터 임베딩으로 변환할 수 있는 `Embeddings` 객체도 전달해야 합니다.

```python
<!--IMPORTS:[{"imported": "UpstashVectorStore", "source": "langchain_community.vectorstores.upstash", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain_community.vectorstores.upstash.UpstashVectorStore.html", "title": "Upstash Vector"}]-->
from langchain_community.vectorstores.upstash import UpstashVectorStore
import os

os.environ["UPSTASH_VECTOR_REST_URL"] = "<UPSTASH_VECTOR_REST_URL>"
os.environ["UPSTASH_VECTOR_REST_TOKEN"] = "<UPSTASH_VECTOR_REST_TOKEN>"

store = UpstashVectorStore(
    embedding=embeddings
)
```


`UpstashVectorStore`의 대안 방법은 `embedding=True`를 전달하는 것입니다. 이는 Upstash Vector 인덱스가 관련된 임베딩 모델을 가질 수 있는 능력 덕분에 `UpstashVectorStore`의 독특한 기능입니다. 이 구성에서는 삽입하려는 문서나 검색하려는 쿼리가 단순히 텍스트로 Upstash Vector에 전송됩니다. 백그라운드에서 Upstash Vector는 이 텍스트를 임베딩하고 이러한 임베딩으로 요청을 실행합니다. 이 기능을 사용하려면 [모델을 선택하여 Upstash Vector 인덱스를 생성](https://upstash.com/docs/vector/features/embeddingmodels#using-a-model)하고 `embedding=True`를 전달합니다:

```python
<!--IMPORTS:[{"imported": "UpstashVectorStore", "source": "langchain_community.vectorstores.upstash", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain_community.vectorstores.upstash.UpstashVectorStore.html", "title": "Upstash Vector"}]-->
from langchain_community.vectorstores.upstash import UpstashVectorStore
import os

os.environ["UPSTASH_VECTOR_REST_URL"] = "<UPSTASH_VECTOR_REST_URL>"
os.environ["UPSTASH_VECTOR_REST_TOKEN"] = "<UPSTASH_VECTOR_REST_TOKEN>"

store = UpstashVectorStore(
    embedding=True
)
```


임베딩 모델에 대한 자세한 내용은 [Upstash Vector 문서](https://upstash.com/docs/vector/features/embeddingmodels)를 참조하세요.

## 네임스페이스
네임스페이스를 사용하여 인덱스에서 데이터를 분할할 수 있습니다. 네임스페이스는 대량의 데이터를 쿼리할 때 유용하며, 쿼리를 더 빠르게 만들기 위해 데이터를 분할하고자 할 때 유용합니다. 네임스페이스를 사용할 경우 결과에 대한 후처리가 없으므로 쿼리 결과가 더 정확해집니다.

```python
<!--IMPORTS:[{"imported": "UpstashVectorStore", "source": "langchain_community.vectorstores.upstash", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain_community.vectorstores.upstash.UpstashVectorStore.html", "title": "Upstash Vector"}]-->
from langchain_community.vectorstores.upstash import UpstashVectorStore
import os

os.environ["UPSTASH_VECTOR_REST_URL"] = "<UPSTASH_VECTOR_REST_URL>"
os.environ["UPSTASH_VECTOR_REST_TOKEN"] = "<UPSTASH_VECTOR_REST_TOKEN>"

store = UpstashVectorStore(
    embedding=embeddings
    namespace="my_namespace"
)
```


### 벡터 삽입

```python
<!--IMPORTS:[{"imported": "CharacterTextSplitter", "source": "langchain.text_splitter", "docs": "https://api.python.langchain.com/en/latest/character/langchain_text_splitters.character.CharacterTextSplitter.html", "title": "Upstash Vector"}, {"imported": "TextLoader", "source": "langchain_community.document_loaders", "docs": "https://api.python.langchain.com/en/latest/document_loaders/langchain_community.document_loaders.text.TextLoader.html", "title": "Upstash Vector"}, {"imported": "OpenAIEmbeddings", "source": "langchain_openai", "docs": "https://api.python.langchain.com/en/latest/embeddings/langchain_openai.embeddings.base.OpenAIEmbeddings.html", "title": "Upstash Vector"}]-->
from langchain.text_splitter import CharacterTextSplitter
from langchain_community.document_loaders import TextLoader
from langchain_openai import OpenAIEmbeddings

loader = TextLoader("../../modules/state_of_the_union.txt")
documents = loader.load()
text_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=0)
docs = text_splitter.split_documents(documents)

# Create a new embeddings object
embeddings = OpenAIEmbeddings()

# Create a new UpstashVectorStore object
store = UpstashVectorStore(
    embedding=embeddings
)

# Insert the document embeddings into the store
store.add_documents(docs)
```


문서를 삽입할 때, 먼저 `Embeddings` 객체를 사용하여 임베딩됩니다.

대부분의 임베딩 모델은 여러 문서를 한 번에 임베딩할 수 있으므로, 문서는 배치 처리되어 병렬로 임베딩됩니다. 배치 크기는 `embedding_chunk_size` 매개변수를 사용하여 제어할 수 있습니다.

임베딩된 벡터는 Upstash Vector 데이터베이스에 저장됩니다. 전송할 때 여러 벡터가 함께 배치되어 HTTP 요청 수를 줄입니다. 배치 크기는 `batch_size` 매개변수를 사용하여 제어할 수 있습니다. Upstash Vector는 무료 요금제에서 배치당 1000개의 벡터 제한이 있습니다.

```python
store.add_documents(
    documents,
    batch_size=100,
    embedding_chunk_size=200
)
```


### 벡터 쿼리

벡터는 텍스트 쿼리 또는 다른 벡터를 사용하여 쿼리할 수 있습니다.

반환 값은 Document 객체의 목록입니다.

```python
result = store.similarity_search(
    "The United States of America",
    k=5
)
```


또는 벡터를 사용하여:

```python
vector = embeddings.embed_query("Hello world")

result = store.similarity_search_by_vector(
    vector,
    k=5
)
```


검색할 때 메타데이터로 필터링할 수 있는 `filter` 매개변수를 활용할 수 있습니다:

```python
result = store.similarity_search(
    "The United States of America",
    k=5,
    filter="type = 'country'"
)
```


메타데이터 필터링에 대한 자세한 내용은 [Upstash Vector 문서](https://upstash.com/docs/vector/features/filtering)를 참조하세요.

### 벡터 삭제

벡터는 ID로 삭제할 수 있습니다.

```python
store.delete(["id1", "id2"])
```


### 저장소 정보 가져오기

info 함수를 사용하여 거리 측정 기준 차원과 같은 데이터베이스 정보를 가져올 수 있습니다.

삽입이 발생하면 데이터베이스에서 인덱싱이 진행됩니다. 이 과정이 진행되는 동안 새로운 벡터는 쿼리할 수 없습니다. `pendingVectorCount`는 현재 인덱싱 중인 벡터의 수를 나타냅니다.

```python
info = store.info()
print(info)

# Output:
# {'vectorCount': 44, 'pendingVectorCount': 0, 'indexSize': 2642412, 'dimension': 1536, 'similarityFunction': 'COSINE'}
```


# Upstash Redis

이 페이지는 LangChain과 함께 [Upstash Redis](https://upstash.com/redis)를 사용하는 방법을 다룹니다.

## 설치 및 설정
- Upstash Redis Python SDK는 `pip install upstash-redis`로 설치할 수 있습니다.
- [Upstash Console](https://console.upstash.com)에서 전 세계적으로 분산된 저지연 및 고가용성 데이터베이스를 생성할 수 있습니다.

## 통합
모든 Upstash-LangChain 통합은 `upstash-redis` Python SDK를 래퍼로 사용하여 이루어집니다. 이 SDK는 콘솔에서 UPSTASH_REDIS_REST_URL 및 UPSTASH_REDIS_REST_TOKEN 매개변수를 제공하여 Upstash Redis DB를 사용합니다.

### 캐시

[Upstash Redis](https://upstash.com/redis)는 LLM 프롬프트 및 응답의 캐시로 사용할 수 있습니다.

이 캐시를 가져오려면:
```python
<!--IMPORTS:[{"imported": "UpstashRedisCache", "source": "langchain.cache", "docs": "https://api.python.langchain.com/en/latest/cache/langchain_community.cache.UpstashRedisCache.html", "title": "Upstash Vector"}]-->
from langchain.cache import UpstashRedisCache
```


LLM과 함께 사용하려면:
```python
import langchain
from upstash_redis import Redis

URL = "<UPSTASH_REDIS_REST_URL>"
TOKEN = "<UPSTASH_REDIS_REST_TOKEN>"

langchain.llm_cache = UpstashRedisCache(redis_=Redis(url=URL, token=TOKEN))
```


### 메모리

[사용 예시](https://docs/integrations/memory/upstash_redis_chat_message_history)를 참조하세요.

```python
<!--IMPORTS:[{"imported": "UpstashRedisChatMessageHistory", "source": "langchain_community.chat_message_histories", "docs": "https://api.python.langchain.com/en/latest/chat_message_histories/langchain_community.chat_message_histories.upstash_redis.UpstashRedisChatMessageHistory.html", "title": "Upstash Vector"}]-->
from langchain_community.chat_message_histories import (
    UpstashRedisChatMessageHistory,
)
```