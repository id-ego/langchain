---
description: Astream Events v2로의 마이그레이션에 대한 정보와 v1과 v2 API 간의 변경 사항을 설명합니다.
sidebar_label: astream_events v2
sidebar_position: 2
---

# Astream Events v2로의 마이그레이션

`0.2.x`의 출시와 함께 astream_events API의 `v2`가 추가되었습니다. 자세한 내용은 이 [PR](https://github.com/langchain-ai/langchain/pull/21638)를 참조하세요.

`v2` 버전은 `v1` 버전을 재작성한 것으로, 더 효율적이며 이벤트에 대한 출력이 더 일관되게 제공됩니다. API의 `v1` 버전은 `v2` 버전으로 대체될 예정이며, `0.4.0`에서 제거됩니다.

아래는 API의 `v1`과 `v2` 버전 간의 변경 사항 목록입니다.

### `on_chat_model_end`의 출력

`v1`에서는 `on_chat_model_end`와 관련된 출력이 채팅 모델이 루트 레벨 실행 가능 항목으로 실행되었는지 또는 체인의 일부로 실행되었는지에 따라 달라졌습니다.

루트 레벨 실행 가능 항목으로서의 출력은:

```python
"data": {"output": AIMessageChunk(content="hello world!", id='some id')}
```


체인의 일부로서의 출력은:

```
            "data": {
                "output": {
                    "generations": [
                        [
                            {
                                "generation_info": None,
                                "message": AIMessageChunk(
                                    content="hello world!", id=AnyStr()
                                ),
                                "text": "hello world!",
                                "type": "ChatGenerationChunk",
                            }
                        ]
                    ],
                    "llm_output": None,
                }
            },
```


`v2`부터는 출력이 항상 더 간단한 표현으로 제공됩니다:

```python
"data": {"output": AIMessageChunk(content="hello world!", id='some id')}
```


:::note
비채팅 모델(즉, 일반 LLM)은 현재 더 장황한 형식과 일관되게 연관될 것입니다.
:::

### `on_retriever_end`의 출력

`on_retriever_end` 출력은 항상 `Documents` 목록을 반환합니다.

이전:
```python
{
    "data": {
        "output": [
            Document(...),
            Document(...),
            ...
        ]
    }
}
```


### `on_retriever_stream` 제거

`on_retriever_stream` 이벤트는 구현의 유물로 제거되었습니다.

이벤트와 관련된 전체 정보는 이미 `on_retriever_end` 이벤트에서 사용할 수 있습니다.

대신 `on_retriever_end`를 사용하세요.

### `on_tool_stream` 제거

`on_tool_stream` 이벤트는 구현의 유물로 제거되었습니다.

이벤트와 관련된 전체 정보는 이미 `on_tool_end` 이벤트에서 사용할 수 있습니다.

대신 `on_tool_end`를 사용하세요.

### 이름 전파

실행 가능 항목의 이름이 더 일관되게 업데이트되었습니다.

```python
model = GenericFakeChatModel(messages=infinite_cycle).configurable_fields(
    messages=ConfigurableField(
        id="messages",
        name="Messages",
        description="Messages return by the LLM",
    )
)
```


`v1`에서는 이벤트 이름이 `RunnableConfigurableFields`였습니다.

`v2`에서는 이벤트 이름이 `GenericFakeChatModel`입니다.

이벤트 이름으로 필터링하는 경우 필터를 업데이트해야 하는지 확인하세요.

### RunnableRetry

LCEL 체인 내에서 스트리밍되는 [RunnableRetry](https://api.python.langchain.com/en/latest/runnables/langchain_core.runnables.retry.RunnableRetry.html)의 사용은 `v1`에서 실패한 실행 가능 항목 호출에 해당하는 잘못된 `on_chain_end` 이벤트를 생성했습니다. 이 이벤트는 `v2`에서 제거되었습니다.

이 변경에 대한 추가 조치는 필요하지 않습니다.