---
description: 벡터 저장소를 생성하고 쿼리하는 방법에 대한 가이드로, 비정형 데이터를 임베딩하고 검색하는 기본 기능을 소개합니다.
---

# 벡터 저장소 생성 및 쿼리 방법

:::info
3rd-party 벡터 저장소와의 내장 통합에 대한 문서는 [Integrations](/docs/integrations/vectorstores/)를 참조하세요.
:::

비구조화된 데이터를 저장하고 검색하는 가장 일반적인 방법 중 하나는 이를 임베드하고 결과 임베딩 벡터를 저장한 다음, 쿼리 시 비구조화된 쿼리를 임베드하여 임베딩 쿼리와 '가장 유사한' 임베딩 벡터를 검색하는 것입니다. 벡터 저장소는 임베드된 데이터를 저장하고 벡터 검색을 수행하는 역할을 합니다.

## 시작하기

이 가이드는 벡터 저장소와 관련된 기본 기능을 보여줍니다. 벡터 저장소 작업의 핵심 부분은 그 안에 넣을 벡터를 생성하는 것으로, 이는 일반적으로 임베딩을 통해 생성됩니다. 따라서 이 주제에 뛰어들기 전에 [텍스트 임베딩 모델 인터페이스](/docs/how_to/embed_text)에 익숙해지는 것이 좋습니다.

벡터 저장소를 사용하기 전에 데이터를 로드하고 임베딩 모델을 초기화해야 합니다.

OpenAIEmbeddings를 사용하고 싶으므로 OpenAI API 키를 받아야 합니다.

```python
import os
import getpass

os.environ['OPENAI_API_KEY'] = getpass.getpass('OpenAI API Key:')
```


```python
<!--IMPORTS:[{"imported": "TextLoader", "source": "langchain_community.document_loaders", "docs": "https://api.python.langchain.com/en/latest/document_loaders/langchain_community.document_loaders.text.TextLoader.html", "title": "How to create and query vector stores"}, {"imported": "OpenAIEmbeddings", "source": "langchain_openai", "docs": "https://api.python.langchain.com/en/latest/embeddings/langchain_openai.embeddings.base.OpenAIEmbeddings.html", "title": "How to create and query vector stores"}, {"imported": "CharacterTextSplitter", "source": "langchain_text_splitters", "docs": "https://api.python.langchain.com/en/latest/character/langchain_text_splitters.character.CharacterTextSplitter.html", "title": "How to create and query vector stores"}]-->
from langchain_community.document_loaders import TextLoader
from langchain_openai import OpenAIEmbeddings
from langchain_text_splitters import CharacterTextSplitter

# Load the document, split it into chunks, embed each chunk and load it into the vector store.
raw_documents = TextLoader('state_of_the_union.txt').load()
text_splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=0)
documents = text_splitter.split_documents(raw_documents)
```


import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

많은 훌륭한 벡터 저장소 옵션이 있으며, 여기에는 무료, 오픈 소스이며 완전히 로컬 머신에서 실행되는 몇 가지가 있습니다. 많은 훌륭한 호스팅 제공을 위해 모든 통합을 검토하세요.

<Tabs>
  <TabItem value="chroma" label="Chroma" default>


이 워크스루는 로컬 머신에서 라이브러리로 실행되는 `chroma` 벡터 데이터베이스를 사용합니다.

```bash
pip install langchain-chroma
```


```python
<!--IMPORTS:[{"imported": "Chroma", "source": "langchain_chroma", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain_chroma.vectorstores.Chroma.html", "title": "How to create and query vector stores"}]-->
from langchain_chroma import Chroma

db = Chroma.from_documents(documents, OpenAIEmbeddings())
```


  </TabItem>
  <TabItem value="faiss" label="FAISS">


이 워크스루는 Facebook AI 유사성 검색(FAISS) 라이브러리를 사용하는 `FAISS` 벡터 데이터베이스를 사용합니다.

```bash
pip install faiss-cpu
```


```python
<!--IMPORTS:[{"imported": "FAISS", "source": "langchain_community.vectorstores", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain_community.vectorstores.faiss.FAISS.html", "title": "How to create and query vector stores"}]-->
from langchain_community.vectorstores import FAISS

db = FAISS.from_documents(documents, OpenAIEmbeddings())
```


  </TabItem>
  <TabItem value="lance" label="Lance">


이 노트북은 Lance 데이터 형식에 기반한 LanceDB 벡터 데이터베이스와 관련된 기능을 사용하는 방법을 보여줍니다.

```bash
pip install lancedb
```


```python
<!--IMPORTS:[{"imported": "LanceDB", "source": "langchain_community.vectorstores", "docs": "https://api.python.langchain.com/en/latest/vectorstores/langchain_community.vectorstores.lancedb.LanceDB.html", "title": "How to create and query vector stores"}]-->
from langchain_community.vectorstores import LanceDB

import lancedb

db = lancedb.connect("/tmp/lancedb")
table = db.create_table(
    "my_table",
    data=[
        {
            "vector": embeddings.embed_query("Hello World"),
            "text": "Hello World",
            "id": "1",
        }
    ],
    mode="overwrite",
)
db = LanceDB.from_documents(documents, OpenAIEmbeddings())
```


  </TabItem>
</Tabs>


## 유사성 검색

모든 벡터 저장소는 `similarity_search` 메서드를 제공합니다.
이 메서드는 들어오는 문서를 받아 임베딩을 생성한 다음, 가장 유사한 임베딩을 가진 모든 문서를 찾습니다.

```python
query = "What did the president say about Ketanji Brown Jackson"
docs = db.similarity_search(query)
print(docs[0].page_content)
```


```
    Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you’re at it, pass the Disclose Act so Americans can know who is funding our elections.

    Tonight, I’d like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer—an Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service.

    One of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court.

    And I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation’s top legal minds, who will continue Justice Breyer’s legacy of excellence.
```


### 벡터에 의한 유사성 검색

주어진 임베딩 벡터와 유사한 문서를 검색하는 것도 가능하며, 이는 문자열 대신 임베딩 벡터를 매개변수로 받아들이는 `similarity_search_by_vector`를 사용합니다.

```python
embedding_vector = OpenAIEmbeddings().embed_query(query)
docs = db.similarity_search_by_vector(embedding_vector)
print(docs[0].page_content)
```


```
    Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you’re at it, pass the Disclose Act so Americans can know who is funding our elections.

    Tonight, I’d like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer—an Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service.

    One of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court.

    And I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation’s top legal minds, who will continue Justice Breyer’s legacy of excellence.
```


## 비동기 작업

벡터 저장소는 일반적으로 일부 IO 작업이 필요한 별도의 서비스로 실행되며, 따라서 비동기적으로 호출될 수 있습니다. 이는 외부 서비스로부터 응답을 기다리는 시간을 낭비하지 않기 때문에 성능 이점을 제공합니다. 이는 [FastAPI](https://fastapi.tiangolo.com/)와 같은 비동기 프레임워크로 작업할 때도 중요할 수 있습니다.

LangChain은 벡터 저장소에서 비동기 작업을 지원합니다. 모든 메서드는 `a` 접두사가 붙은 비동기 대응 메서드를 사용하여 호출할 수 있습니다.

```python
docs = await db.asimilarity_search(query)
docs
```


```
[Document(page_content='Tonight. I call on the Senate to: Pass the Freedom to Vote Act. Pass the John Lewis Voting Rights Act. And while you’re at it, pass the Disclose Act so Americans can know who is funding our elections. \n\nTonight, I’d like to honor someone who has dedicated his life to serve this country: Justice Stephen Breyer—an Army veteran, Constitutional scholar, and retiring Justice of the United States Supreme Court. Justice Breyer, thank you for your service. \n\nOne of the most serious constitutional responsibilities a President has is nominating someone to serve on the United States Supreme Court. \n\nAnd I did that 4 days ago, when I nominated Circuit Court of Appeals Judge Ketanji Brown Jackson. One of our nation’s top legal minds, who will continue Justice Breyer’s legacy of excellence.', metadata={'source': 'state_of_the_union.txt'}),
 Document(page_content='A former top litigator in private practice. A former federal public defender. And from a family of public school educators and police officers. A consensus builder. Since she’s been nominated, she’s received a broad range of support—from the Fraternal Order of Police to former judges appointed by Democrats and Republicans. \n\nAnd if we are to advance liberty and justice, we need to secure the Border and fix the immigration system. \n\nWe can do both. At our border, we’ve installed new technology like cutting-edge scanners to better detect drug smuggling.  \n\nWe’ve set up joint patrols with Mexico and Guatemala to catch more human traffickers.  \n\nWe’re putting in place dedicated immigration judges so families fleeing persecution and violence can have their cases heard faster. \n\nWe’re securing commitments and supporting partners in South and Central America to host more refugees and secure their own borders.', metadata={'source': 'state_of_the_union.txt'}),
 Document(page_content='And for our LGBTQ+ Americans, let’s finally get the bipartisan Equality Act to my desk. The onslaught of state laws targeting transgender Americans and their families is wrong. \n\nAs I said last year, especially to our younger transgender Americans, I will always have your back as your President, so you can be yourself and reach your God-given potential. \n\nWhile it often appears that we never agree, that isn’t true. I signed 80 bipartisan bills into law last year. From preventing government shutdowns to protecting Asian-Americans from still-too-common hate crimes to reforming military justice. \n\nAnd soon, we’ll strengthen the Violence Against Women Act that I first wrote three decades ago. It is important for us to show the nation that we can come together and do big things. \n\nSo tonight I’m offering a Unity Agenda for the Nation. Four big things we can do together.  \n\nFirst, beat the opioid epidemic.', metadata={'source': 'state_of_the_union.txt'}),
 Document(page_content='Tonight, I’m announcing a crackdown on these companies overcharging American businesses and consumers. \n\nAnd as Wall Street firms take over more nursing homes, quality in those homes has gone down and costs have gone up.  \n\nThat ends on my watch. \n\nMedicare is going to set higher standards for nursing homes and make sure your loved ones get the care they deserve and expect. \n\nWe’ll also cut costs and keep the economy going strong by giving workers a fair shot, provide more training and apprenticeships, hire them based on their skills not degrees. \n\nLet’s pass the Paycheck Fairness Act and paid leave.  \n\nRaise the minimum wage to $15 an hour and extend the Child Tax Credit, so no one has to raise a family in poverty. \n\nLet’s increase Pell Grants and increase our historic support of HBCUs, and invest in what Jill—our First Lady who teaches full-time—calls America’s best-kept secret: community colleges.', metadata={'source': 'state_of_the_union.txt'})]
```